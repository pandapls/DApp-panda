{"version":3,"file":"index.modern.mjs","sources":["../src/atomWithImmer.ts","../src/withImmer.ts","../src/useSetImmerAtom.ts","../src/useImmerAtom.ts"],"sourcesContent":["import { produce } from 'immer'\nimport type { Draft } from 'immer'\nimport { atom } from 'jotai/vanilla'\nimport type { WritableAtom } from 'jotai/vanilla'\n\nexport function atomWithImmer<Value>(\n  initialValue: Value\n): WritableAtom<Value, [Value | ((draft: Draft<Value>) => void)], void> {\n  const anAtom: any = atom(\n    initialValue,\n    (get, set, fn: Value | ((draft: Draft<Value>) => void)) =>\n      set(\n        anAtom,\n        produce(\n          get(anAtom),\n          typeof fn === 'function'\n            ? (fn as (draft: Draft<Value>) => void)\n            : () => fn\n        )\n      )\n  )\n  return anAtom\n}\n","import { produce } from 'immer'\nimport type { Draft } from 'immer'\nimport { atom } from 'jotai/vanilla'\nimport type { PrimitiveAtom, WritableAtom } from 'jotai/vanilla'\n\nconst cache1 = new WeakMap()\nconst memo1 = <T>(create: () => T, dep1: object): T =>\n  (cache1.has(dep1) ? cache1 : cache1.set(dep1, create())).get(dep1)\n\nexport function withImmer<Value>(\n  anAtom: PrimitiveAtom<Value>\n): WritableAtom<Value, [Value | ((draft: Draft<Value>) => void)], void>\n\nexport function withImmer<Value, Result>(\n  anAtom: WritableAtom<Value, [Value], Result>\n): WritableAtom<Value, [Value | ((draft: Draft<Value>) => void)], Result>\n\nexport function withImmer<Value, Result>(\n  anAtom: WritableAtom<Value, [Value], Result>\n) {\n  return memo1(() => {\n    const derivedAtom = atom(\n      (get) => get(anAtom),\n      (get, set, fn: Value | ((draft: Draft<Value>) => void)) =>\n        set(\n          anAtom,\n          produce(\n            get(anAtom),\n            typeof fn === 'function'\n              ? (fn as (draft: Draft<Value>) => void)\n              : () => fn\n          )\n        )\n    )\n    return derivedAtom\n  }, anAtom)\n}\n","import { useCallback } from 'react'\nimport { produce } from 'immer'\nimport type { Draft } from 'immer'\nimport { useSetAtom } from 'jotai/react'\nimport type { WritableAtom } from 'jotai/vanilla'\n\ntype Options = Parameters<typeof useSetAtom>[1]\n\nexport function useSetImmerAtom<Value, Result>(\n  anAtom: WritableAtom<Value, [(draft: Draft<Value>) => void], Result>,\n  options?: Options\n): (fn: (draft: Draft<Value>) => void) => Result\n\nexport function useSetImmerAtom<Value, Result>(\n  anAtom: WritableAtom<Value, [(value: Value) => Value], Result>,\n  options?: Options\n): (fn: (draft: Draft<Value>) => void) => Result\n\nexport function useSetImmerAtom<Value, Result>(\n  anAtom: WritableAtom<Value, [(value: Value) => Value], Result>,\n  options?: Options\n) {\n  const setState = useSetAtom(anAtom, options)\n  return useCallback(\n    (fn: (draft: Draft<Value>) => void) => setState(produce(fn)),\n    [setState]\n  )\n}\n","import type { Draft } from 'immer'\nimport { useAtomValue } from 'jotai/react'\nimport type { WritableAtom } from 'jotai/vanilla'\nimport { useSetImmerAtom } from './useSetImmerAtom'\n\ntype Options = Parameters<typeof useAtomValue>[1]\n\nexport function useImmerAtom<Value, Result>(\n  anAtom: WritableAtom<Value, [(draft: Draft<Value>) => void], Result>,\n  options?: Options\n): [Value, (fn: (draft: Draft<Value>) => void) => Result]\n\nexport function useImmerAtom<Value, Result>(\n  anAtom: WritableAtom<Value, [(value: Value) => Value], Result>,\n  options?: Options\n): [Value, (fn: (draft: Draft<Value>) => void) => Result]\n\nexport function useImmerAtom<Value, Result>(\n  anAtom: WritableAtom<Value, [(value: Value) => Value], Result>,\n  options?: Options\n) {\n  return [useAtomValue(anAtom, options), useSetImmerAtom(anAtom, options)]\n}\n"],"names":["atomWithImmer","initialValue","anAtom","atom","get","set","fn","produce","cache1","WeakMap","withImmer","create","has","dep1","memo1","useSetImmerAtom","options","setState","useSetAtom","useCallback","useImmerAtom","useAtomValue"],"mappings":"oKAKM,SAAUA,EACdC,GAEA,MAAMC,EAAcC,EAClBF,EACA,CAACG,EAAKC,EAAKC,IACTD,EACEH,EACAK,EACEH,EAAIF,GACU,mBAAPI,EACFA,EACD,IAAMA,KAIlB,OAAOJ,CACT,CCjBA,MAAMM,EAAS,IAAIC,QAYb,SAAUC,EACdR,GAEA,OAdgBS,EAcH,IACSR,EACjBC,GAAQA,EAAIF,GACb,CAACE,EAAKC,EAAKC,IACTD,EACEH,EACAK,EACEH,EAAIF,GACU,mBAAPI,EACFA,EACD,IAAMA,MAvBnBE,EAAOI,IADyBC,EA6B9BX,GA5BiBM,EAASA,EAAOH,IAAIQ,EAAMF,MAAWP,IAAIS,GADjDC,IAAIH,EAAiBE,CA8BnC,CClBgB,SAAAE,EACdb,EACAc,GAEA,MAAMC,EAAWC,EAAWhB,EAAQc,GACpC,OAAOG,EACJb,GAAsCW,EAASV,EAAQD,IACxD,CAACW,GAEL,CCVgB,SAAAG,EACdlB,EACAc,GAEA,MAAO,CAACK,EAAanB,EAAQc,GAAUD,EAAgBb,EAAQc,GACjE"}