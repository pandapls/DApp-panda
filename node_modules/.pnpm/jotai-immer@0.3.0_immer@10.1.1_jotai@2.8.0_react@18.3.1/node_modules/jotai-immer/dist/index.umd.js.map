{"version":3,"file":"index.umd.js","sources":["../src/withImmer.ts","../src/useSetImmerAtom.ts","../src/atomWithImmer.ts","../src/useImmerAtom.ts"],"sourcesContent":["import { produce } from 'immer'\nimport type { Draft } from 'immer'\nimport { atom } from 'jotai/vanilla'\nimport type { PrimitiveAtom, WritableAtom } from 'jotai/vanilla'\n\nconst cache1 = new WeakMap()\nconst memo1 = <T>(create: () => T, dep1: object): T =>\n  (cache1.has(dep1) ? cache1 : cache1.set(dep1, create())).get(dep1)\n\nexport function withImmer<Value>(\n  anAtom: PrimitiveAtom<Value>\n): WritableAtom<Value, [Value | ((draft: Draft<Value>) => void)], void>\n\nexport function withImmer<Value, Result>(\n  anAtom: WritableAtom<Value, [Value], Result>\n): WritableAtom<Value, [Value | ((draft: Draft<Value>) => void)], Result>\n\nexport function withImmer<Value, Result>(\n  anAtom: WritableAtom<Value, [Value], Result>\n) {\n  return memo1(() => {\n    const derivedAtom = atom(\n      (get) => get(anAtom),\n      (get, set, fn: Value | ((draft: Draft<Value>) => void)) =>\n        set(\n          anAtom,\n          produce(\n            get(anAtom),\n            typeof fn === 'function'\n              ? (fn as (draft: Draft<Value>) => void)\n              : () => fn\n          )\n        )\n    )\n    return derivedAtom\n  }, anAtom)\n}\n","import { useCallback } from 'react'\nimport { produce } from 'immer'\nimport type { Draft } from 'immer'\nimport { useSetAtom } from 'jotai/react'\nimport type { WritableAtom } from 'jotai/vanilla'\n\ntype Options = Parameters<typeof useSetAtom>[1]\n\nexport function useSetImmerAtom<Value, Result>(\n  anAtom: WritableAtom<Value, [(draft: Draft<Value>) => void], Result>,\n  options?: Options\n): (fn: (draft: Draft<Value>) => void) => Result\n\nexport function useSetImmerAtom<Value, Result>(\n  anAtom: WritableAtom<Value, [(value: Value) => Value], Result>,\n  options?: Options\n): (fn: (draft: Draft<Value>) => void) => Result\n\nexport function useSetImmerAtom<Value, Result>(\n  anAtom: WritableAtom<Value, [(value: Value) => Value], Result>,\n  options?: Options\n) {\n  const setState = useSetAtom(anAtom, options)\n  return useCallback(\n    (fn: (draft: Draft<Value>) => void) => setState(produce(fn)),\n    [setState]\n  )\n}\n","import { produce } from 'immer'\nimport type { Draft } from 'immer'\nimport { atom } from 'jotai/vanilla'\nimport type { WritableAtom } from 'jotai/vanilla'\n\nexport function atomWithImmer<Value>(\n  initialValue: Value\n): WritableAtom<Value, [Value | ((draft: Draft<Value>) => void)], void> {\n  const anAtom: any = atom(\n    initialValue,\n    (get, set, fn: Value | ((draft: Draft<Value>) => void)) =>\n      set(\n        anAtom,\n        produce(\n          get(anAtom),\n          typeof fn === 'function'\n            ? (fn as (draft: Draft<Value>) => void)\n            : () => fn\n        )\n      )\n  )\n  return anAtom\n}\n","import type { Draft } from 'immer'\nimport { useAtomValue } from 'jotai/react'\nimport type { WritableAtom } from 'jotai/vanilla'\nimport { useSetImmerAtom } from './useSetImmerAtom'\n\ntype Options = Parameters<typeof useAtomValue>[1]\n\nexport function useImmerAtom<Value, Result>(\n  anAtom: WritableAtom<Value, [(draft: Draft<Value>) => void], Result>,\n  options?: Options\n): [Value, (fn: (draft: Draft<Value>) => void) => Result]\n\nexport function useImmerAtom<Value, Result>(\n  anAtom: WritableAtom<Value, [(value: Value) => Value], Result>,\n  options?: Options\n): [Value, (fn: (draft: Draft<Value>) => void) => Result]\n\nexport function useImmerAtom<Value, Result>(\n  anAtom: WritableAtom<Value, [(value: Value) => Value], Result>,\n  options?: Options\n) {\n  return [useAtomValue(anAtom, options), useSetImmerAtom(anAtom, options)]\n}\n"],"names":["cache1","WeakMap","useSetImmerAtom","anAtom","options","setState","useSetAtom","useCallback","fn","produce","initialValue","atom","get","set","useAtomValue","create","has","dep1"],"mappings":"8YAKA,IAAMA,EAAS,IAAIC,QCaH,SAAAC,EACdC,EACAC,GAEA,IAAMC,EAAWC,aAAWH,EAAQC,GACpC,OAAOG,EAAWA,YAChB,SAACC,UAAsCH,EAASI,EAAAA,QAAQD,GAAI,EAC5D,CAACH,GAEL,iBCtBgB,SACdK,GAEA,IAAMP,EAAcQ,EAAAA,KAClBD,EACA,SAACE,EAAKC,EAAKL,GAA2C,OACpDK,EACEV,EACAM,UACEG,EAAIT,GACU,mBAAPK,EACFA,EACD,WAAM,OAAAA,CAAE,GAEf,GAEL,OAAOL,CACT,iBCLgB,SACdA,EACAC,GAEA,MAAO,CAACU,EAAYA,aAACX,EAAQC,GAAUF,EAAgBC,EAAQC,GACjE,kCHLgB,SACdD,GAEA,OAdgBY,EAcH,WAcX,OAboBJ,EAAIA,KACtB,SAACC,GAAG,OAAKA,EAAIT,EAAO,EACpB,SAACS,EAAKC,EAAKL,GACT,OAAAK,EACEV,EACAM,EAAOA,QACLG,EAAIT,GACU,mBAAPK,EACFA,EACD,WAAA,OAAMA,CAAE,GAEf,EAGP,GA5BCR,EAAOgB,IADyBC,EA6B9Bd,GA5BiBH,EAASA,EAAOa,IAAII,EAAMF,MAAWH,IAAIK,GADjD,IAAIF,EAAiBE,CA8BnC"}